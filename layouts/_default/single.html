{{ define "main" }}
{{- /* NOTE that this file is based on the Persian Hugo theme */ -}}

<section>
  <div class="container-fluid">
    <div class="post">
      {{- /* TODO: Modify existing pages to use resources instead of direct URL's here */ -}}
      {{- /* .Params.image is the front matter for each page, have to get match from what is */ -}}
      {{- /* essentially a `ls images/` within this page's bundle */ -}}
      {{- /* First, let's check for backward compatibility refs */ -}}
      {{ $image_url := "" }}
      {{ $image_alt := "" }}
      {{ $image_title := "" }}
      {{- if and (isset .Params "image") (hasPrefix (.Params.image) "/img") -}}
      {{- $image_url = (absURL .Params.image) -}}
      {{- $image_alt = .Params.imagealt }}
      {{- $image_title = .Params.imagetitle }}
      {{ else if (.Resources.ByType "image").GetMatch (printf "%s" .Params.image) }}
      {{ $image_match := (.Resources.ByType "image").GetMatch (.Params.image) }}
      {{ with $image_match }}
      {{ $image_url = $image_match.Permalink }}
      {{- with $image_match.Params.Get "alt" }}{{ $image_alt = . }}{{ end -}}
      {{- with $image_match.Title }}{{ $image_title = . }}{{ end -}}
      {{ end }}
      {{- else -}}
        {{- /* The (former) about page comes through here - TODO? */ -}}
        {{- /* If no resources or direct img top content is provided, it goes through here */ -}}
      {{ end -}}
      {{ if ne $image_url "" }}
      <img src='{{ $image_url }}' class="img-fluid w-100" alt='{{ $image_alt }}' title='{{ $image_title }}' class='post_thumbnail'>
      {{ end }}
      <div class="post-content">
        <div class="post-date">
          <span>{{ .PublishDate.Format "02" }}</span>
          <span>{{ .PublishDate.Format "Jan" }}</span>
        </div>
        <h2 class="post-title">{{ .Title }}</h2>
      </div>
    </div>
  </div>
</section>

<section class="section-sm" style="padding-top: 10px; padding-bottom: 10px">
  <div class="container">
    <div class="row">
      <div style="margin-left: 0%; margin-right: 0%;";>
        <div class="content">{{.Content}}</div>
        <div class="text-center mt-5">
          <ul class="list-inline post-meta d-inline-block mr-4">
            <li class="list-inline-item"><i class="ti-tag"></i></li>
            {{ range .Params.Tags }}
            <li class="list-inline-item">
              <a href="{{ `tags/` | relLangURL }}{{ . | urlize | lower }}/">{{ . | humanize }}</a>
            </li>
            {{ end }}
          </ul>
          {{ if (isset .Params "author") }}
          <span><i class="ti-user mr-2"></i><a
              href="{{ `author/` | relLangURL }}{{ .Params.author | urlize }}/">{{ .Params.author }}</a></span>
          {{ end }}
        </div>
      </div>
    </div>
  </div>
</section>

{{ partial "relatedposts" . }}

{{ if .Site.DisqusShortname }}
<section class="section-sm bg-light">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        {{ template "_internal/disqus.html" . }}
      </div>
    </div>
  </div>
</section>
{{ end }}

{{ end }}